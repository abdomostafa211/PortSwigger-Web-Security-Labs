Lab 2: CSRF vulnerability with no defenses (APPRENTICE) üõ°Ô∏è

Description & Mission

The email change functionality is susceptible to a Cross-Site Request Forgery (CSRF) attack due to the complete lack of CSRF defenses.

Objective üéØ

To craft a malicious HTML payload that exploits the CSRF vulnerability to change the victim's email address and upload it to the exploit server.

Credentials:

wiener:peter

Steps to Solution ü™ú

    Request Interception and Analysis:

        Logged in with the test credentials (wiener:peter).

        Used Burp Suite to intercept the legitimate request to change the email.

        The request was a POST request to the /my-account/change-email endpoint.

        Request Body: email=wiener2%40normal-user.net (URL-encoded).

    Identifying the Vulnerability:

        Crucially, the request contained no unpredictable parameters, such as a CSRF token, in the body or headers.

        The application relies solely on the session cookie for authorization, which is a classic condition for a CSRF vulnerability.

    Crafting the Exploit Payload:

        An HTML form was created to mimic the structure of the legitimate POST request, but pointed to the victim's domain. JavaScript was added for auto-submission.

Exploit Code (HTML Payload):

HTML

<form method="POST" action="https://[LAB_ID].web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="5wiener@normal-user.net">
</form>
<script>
    // Automatically submits the form upon page load.
    document.forms[0].submit();
</script>

    Execution and Confirmation:

        The payload was uploaded to the Exploit Server.

        When delivered to the victim, their browser automatically submitted the form, including their valid session cookie, resulting in a successful email change and solving the lab.

Final Result (Flag) ‚úÖ

Successfully changed the victim's email address using a CSRF attack.

Security Notes üìù

    Defense Mechanism: The most effective defense is implementing a Synchronizer Token Pattern, where a unique, unpredictable CSRF token is included in the request body and validated by the server.

    Best Practice: Always assume sensitive actions (like changing user information) are targets for CSRF and implement strong token-based protection.

