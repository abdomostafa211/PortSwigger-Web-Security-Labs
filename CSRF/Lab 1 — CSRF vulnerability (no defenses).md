2. Lab: CSRF vulnerability with no defenses (APPRENTICE) üõ°Ô∏è

Mission Description

The application's email change functionality is vulnerable to Cross-Site Request Forgery (CSRF) because it implements no defenses against this attack.

Objective üéØ

Craft an HTML payload using a CSRF attack to change the victim's email address and host it on the Exploit Server.

Steps to Reproduce and Exploit ü™ú

    Request Analysis:

        Logged in using the provided credentials (wiener:peter).

        Intercepted the legitimate email change request using Burp Suite.

        The request was a POST to /my-account/change-email with the body containing only the email parameter.

    Identifying Weakness:

        Crucially, the request did not contain any CSRF Token or other unpredictable values. The application relies solely on the user's Session Cookie for authorization.

    Exploit Code Creation:

        Created an HTML form that perfectly mimics the vulnerable request, forcing the victim's browser to submit the request to the application's endpoint.

Exploit Payload

HTML

<form method="POST" action="https://[LAB_ID].web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="pwned@attacker.net">
</form>
<script>
    // Auto-submit the form to silently execute the attack
    document.forms[0].submit();
</script>

    Execution:

        The payload was uploaded to the Exploit Server and delivered to the victim.

        The victim's browser automatically submits the form, including their valid session cookie, successfully changing their email address.

Vulnerability & Solution ‚úÖ

The lab was solved by successfully hosting and delivering the malicious HTML payload.

Notes üìù

    Vulnerability Type: CSRF (Classic No-Defenses scenario).

    Impact: An attacker can force authenticated users to perform state-changing actions (like changing email, password, or making purchases) without their consent.

    Mitigation: Implement strong CSRF Tokens in all state-changing POST requests. The tokens must be unique, secret, and tied to the user's session.
